{
  "name": "dialog",
  "type": "registry:component",
  "files": [
    {
      "name": "dialog.component.ts",
      "content": "import { OverlayModule } from '@angular/cdk/overlay';\nimport {\n  BasePortalOutlet,\n  CdkPortalOutlet,\n  type ComponentPortal,\n  PortalModule,\n  type TemplatePortal,\n} from '@angular/cdk/portal';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  type ComponentRef,\n  computed,\n  ElementRef,\n  type EmbeddedViewRef,\n  type EventEmitter,\n  inject,\n  NgModule,\n  output,\n  type TemplateRef,\n  type Type,\n  viewChild,\n  type ViewContainerRef,\n} from '@angular/core';\n\nimport type { ZardDialogRef } from './dialog-ref';\nimport { ZardDialogService } from './dialog.service';\nimport { dialogVariants } from './dialog.variants';\nimport { mergeClasses, noopFun } from '../../shared/utils/utils';\nimport { ZardButtonComponent } from '../button/button.component';\nimport { ZardIconComponent } from '../icon/icon.component';\nimport type { ZardIcon } from '../icon/icons';\n// Used by the NgModule provider definition\n\nexport type OnClickCallback<T> = (instance: T) => false | void | object;\nexport class ZardDialogOptions<T, U> {\n  zCancelIcon?: ZardIcon;\n  zCancelText?: string | null;\n  zClosable?: boolean;\n  zContent?: string | TemplateRef<T> | Type<T>;\n  zCustomClasses?: string;\n  zData?: U;\n  zDescription?: string;\n  zHideFooter?: boolean;\n  zMaskClosable?: boolean;\n  zOkDestructive?: boolean;\n  zOkDisabled?: boolean;\n  zOkIcon?: ZardIcon;\n  zOkText?: string | null;\n  zOnCancel?: EventEmitter<T> | OnClickCallback<T> = noopFun;\n  zOnOk?: EventEmitter<T> | OnClickCallback<T> = noopFun;\n  zTitle?: string | TemplateRef<T>;\n  zViewContainerRef?: ViewContainerRef;\n  zWidth?: string;\n}\n\n@Component({\n  selector: 'z-dialog',\n  imports: [OverlayModule, PortalModule, ZardButtonComponent, ZardIconComponent],\n  template: `\n    @if (config.zClosable || config.zClosable === undefined) {\n      <button\n        type=\"button\"\n        data-testid=\"z-close-header-button\"\n        z-button\n        zType=\"ghost\"\n        zSize=\"sm\"\n        class=\"absolute top-1 right-1\"\n        (click)=\"onCloseClick()\"\n      >\n        <z-icon zType=\"x\" />\n      </button>\n    }\n\n    @if (config.zTitle || config.zDescription) {\n      <header class=\"flex flex-col space-y-1.5 text-center sm:text-left\">\n        @if (config.zTitle) {\n          <h4 data-testid=\"z-title\" class=\"text-lg leading-none font-semibold tracking-tight\">{{ config.zTitle }}</h4>\n\n          @if (config.zDescription) {\n            <p data-testid=\"z-description\" class=\"text-muted-foreground text-sm\">{{ config.zDescription }}</p>\n          }\n        }\n      </header>\n    }\n\n    <main class=\"flex flex-col space-y-4\">\n      <ng-template cdkPortalOutlet />\n\n      @if (isStringContent) {\n        <div data-testid=\"z-content\" [innerHTML]=\"config.zContent\"></div>\n      }\n    </main>\n\n    @if (!config.zHideFooter) {\n      <footer class=\"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end sm:gap-0 sm:space-x-2\">\n        @if (config.zCancelText !== null) {\n          <button type=\"button\" data-testid=\"z-cancel-button\" z-button zType=\"outline\" (click)=\"onCloseClick()\">\n            @if (config.zCancelIcon) {\n              <z-icon [zType]=\"config.zCancelIcon\" />\n            }\n\n            {{ config.zCancelText ?? 'Cancel' }}\n          </button>\n        }\n\n        @if (config.zOkText !== null) {\n          <button\n            type=\"button\"\n            data-testid=\"z-ok-button\"\n            z-button\n            [zType]=\"config.zOkDestructive ? 'destructive' : 'default'\"\n            [disabled]=\"config.zOkDisabled\"\n            (click)=\"onOkClick()\"\n          >\n            @if (config.zOkIcon) {\n              <z-icon [zType]=\"config.zOkIcon\" />\n            }\n\n            {{ config.zOkText ?? 'OK' }}\n          </button>\n        }\n      </footer>\n    }\n  `,\n  styles: `\n    :host {\n      opacity: 1;\n      transform: scale(1);\n      transition:\n        opacity 150ms ease-out,\n        transform 150ms ease-out;\n    }\n\n    @starting-style {\n      :host {\n        opacity: 0;\n        transform: scale(0.9);\n      }\n    }\n\n    :host.dialog-leave {\n      opacity: 0;\n      transform: scale(0.9);\n      transition:\n        opacity 150ms ease-in,\n        transform 150ms ease-in;\n    }\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  host: {\n    '[class]': 'classes()',\n    '[style.width]': 'config.zWidth ? config.zWidth : null',\n    'animate.enter': 'dialog-enter',\n    'animate.leave': 'dialog-leave',\n  },\n  exportAs: 'zDialog',\n})\nexport class ZardDialogComponent<T, U> extends BasePortalOutlet {\n  private readonly host = inject(ElementRef<HTMLElement>);\n  protected readonly config = inject(ZardDialogOptions<T, U>);\n\n  protected readonly classes = computed(() => mergeClasses(dialogVariants(), this.config.zCustomClasses));\n  dialogRef?: ZardDialogRef<T>;\n\n  protected readonly isStringContent = typeof this.config.zContent === 'string';\n\n  readonly portalOutlet = viewChild.required(CdkPortalOutlet);\n\n  okTriggered = output<void>();\n  cancelTriggered = output<void>();\n\n  constructor() {\n    super();\n  }\n\n  getNativeElement(): HTMLElement {\n    return this.host.nativeElement;\n  }\n\n  attachComponentPortal<T>(portal: ComponentPortal<T>): ComponentRef<T> {\n    if (this.portalOutlet()?.hasAttached()) {\n      throw new Error('Attempting to attach modal content after content is already attached');\n    }\n    return this.portalOutlet()?.attachComponentPortal(portal);\n  }\n\n  attachTemplatePortal<C>(portal: TemplatePortal<C>): EmbeddedViewRef<C> {\n    if (this.portalOutlet()?.hasAttached()) {\n      throw new Error('Attempting to attach modal content after content is already attached');\n    }\n\n    return this.portalOutlet()?.attachTemplatePortal(portal);\n  }\n\n  onOkClick() {\n    this.okTriggered.emit();\n  }\n\n  onCloseClick() {\n    this.cancelTriggered.emit();\n  }\n}\n\n@NgModule({\n  imports: [ZardButtonComponent, ZardDialogComponent, OverlayModule, PortalModule],\n  providers: [ZardDialogService],\n})\nexport class ZardDialogModule {}\n"
    },
    {
      "name": "dialog.service.ts",
      "content": "import { type ComponentType, Overlay, OverlayConfig, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal, TemplatePortal } from '@angular/cdk/portal';\nimport { isPlatformBrowser } from '@angular/common';\nimport {\n  inject,\n  Injectable,\n  InjectionToken,\n  Injector,\n  PLATFORM_ID,\n  TemplateRef,\n  ViewContainerRef,\n} from '@angular/core';\n\nimport { ZardDialogRef } from './dialog-ref';\nimport { ZardDialogComponent, ZardDialogOptions } from './dialog.component';\n\ntype ContentType<T> = ComponentType<T> | TemplateRef<T> | string;\n\nexport const Z_MODAL_DATA = new InjectionToken<any>('Z_MODAL_DATA');\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ZardDialogService {\n  private overlay = inject(Overlay);\n  private injector = inject(Injector);\n  private platformId = inject(PLATFORM_ID);\n\n  create<T, U>(config: ZardDialogOptions<T, U>): ZardDialogRef<T> {\n    return this.open<T, U>(config.zContent as ComponentType<T>, config);\n  }\n\n  private open<T, U>(componentOrTemplateRef: ContentType<T>, config: ZardDialogOptions<T, U>) {\n    const overlayRef = this.createOverlay();\n\n    if (!overlayRef) {\n      return new ZardDialogRef(\n        undefined as unknown as OverlayRef,\n        config,\n        undefined as unknown as ZardDialogComponent<T, U>,\n        this.platformId,\n      );\n    }\n\n    const dialogContainer = this.attachDialogContainer<T, U>(overlayRef, config);\n    const dialogRef = this.attachDialogContent<T, U>(componentOrTemplateRef, dialogContainer, overlayRef, config);\n\n    dialogContainer.dialogRef = dialogRef;\n\n    return dialogRef;\n  }\n\n  private createOverlay(): OverlayRef | undefined {\n    if (isPlatformBrowser(this.platformId)) {\n      const overlayConfig = new OverlayConfig({\n        hasBackdrop: true,\n        positionStrategy: this.overlay.position().global(),\n      });\n\n      return this.overlay.create(overlayConfig);\n    }\n\n    return undefined;\n  }\n\n  private attachDialogContainer<T, U>(overlayRef: OverlayRef, config: ZardDialogOptions<T, U>) {\n    const injector = Injector.create({\n      parent: this.injector,\n      providers: [\n        { provide: OverlayRef, useValue: overlayRef },\n        { provide: ZardDialogOptions, useValue: config },\n      ],\n    });\n\n    const containerPortal = new ComponentPortal<ZardDialogComponent<T, U>>(\n      ZardDialogComponent,\n      config.zViewContainerRef,\n      injector,\n    );\n\n    const containerRef = overlayRef.attach<ZardDialogComponent<T, U>>(containerPortal);\n\n    return containerRef.instance;\n  }\n\n  private attachDialogContent<T, U>(\n    componentOrTemplateRef: ContentType<T>,\n    dialogContainer: ZardDialogComponent<T, U>,\n    overlayRef: OverlayRef,\n    config: ZardDialogOptions<T, U>,\n  ) {\n    const dialogRef = new ZardDialogRef<T>(overlayRef, config, dialogContainer, this.platformId);\n\n    if (componentOrTemplateRef instanceof TemplateRef) {\n      dialogContainer.attachTemplatePortal(\n        new TemplatePortal<T>(\n          componentOrTemplateRef,\n          null as unknown as ViewContainerRef,\n          {\n            dialogRef,\n          } as T,\n        ),\n      );\n    } else if (typeof componentOrTemplateRef !== 'string') {\n      const injector = this.createInjector<T, U>(dialogRef, config);\n      const contentRef = dialogContainer.attachComponentPortal<T>(\n        new ComponentPortal(componentOrTemplateRef, config.zViewContainerRef, injector),\n      );\n      dialogRef.componentInstance = contentRef.instance;\n    }\n\n    return dialogRef;\n  }\n\n  private createInjector<T, U>(dialogRef: ZardDialogRef<T>, config: ZardDialogOptions<T, U>) {\n    return Injector.create({\n      parent: this.injector,\n      providers: [\n        { provide: ZardDialogRef, useValue: dialogRef },\n        { provide: Z_MODAL_DATA, useValue: config.zData },\n      ],\n    });\n  }\n}\n"
    },
    {
      "name": "dialog-ref.ts",
      "content": "import type { OverlayRef } from '@angular/cdk/overlay';\nimport { isPlatformBrowser } from '@angular/common';\nimport { EventEmitter, Inject, PLATFORM_ID } from '@angular/core';\n\nimport { filter, fromEvent, Subject, takeUntil } from 'rxjs';\n\nimport type { ZardDialogComponent, ZardDialogOptions } from './dialog.component';\n\nconst enum eTriggerAction {\n  CANCEL = 'cancel',\n  OK = 'ok',\n}\n\nexport class ZardDialogRef<T = any, R = any, U = any> {\n  private destroy$ = new Subject<void>();\n  private isClosing = false;\n  protected result?: R;\n  componentInstance: T | null = null;\n\n  constructor(\n    private overlayRef: OverlayRef,\n    private config: ZardDialogOptions<T, U>,\n    private containerInstance: ZardDialogComponent<T, U>,\n    @Inject(PLATFORM_ID) private platformId: object,\n  ) {\n    this.containerInstance.cancelTriggered.subscribe(() => this.trigger(eTriggerAction.CANCEL));\n    this.containerInstance.okTriggered.subscribe(() => this.trigger(eTriggerAction.OK));\n\n    if ((this.config.zMaskClosable ?? true) && isPlatformBrowser(this.platformId)) {\n      this.overlayRef\n        .outsidePointerEvents()\n        .pipe(takeUntil(this.destroy$))\n        .subscribe(() => this.close());\n    }\n\n    if (isPlatformBrowser(this.platformId)) {\n      fromEvent<KeyboardEvent>(document, 'keydown')\n        .pipe(\n          filter(event => event.key === 'Escape'),\n          takeUntil(this.destroy$),\n        )\n        .subscribe(() => this.close());\n    }\n  }\n\n  close(result?: R) {\n    if (this.isClosing) {\n      return;\n    }\n\n    this.isClosing = true;\n    this.result = result;\n\n    if (isPlatformBrowser(this.platformId)) {\n      const hostElement = this.containerInstance.getNativeElement();\n      hostElement.classList.add('dialog-leave');\n    }\n\n    setTimeout(() => {\n      if (this.overlayRef) {\n        if (this.overlayRef.hasAttached()) {\n          this.overlayRef.detachBackdrop();\n        }\n        this.overlayRef.dispose();\n      }\n\n      if (!this.destroy$.closed) {\n        this.destroy$.next();\n        this.destroy$.complete();\n      }\n    }, 150);\n  }\n\n  private trigger(action: eTriggerAction) {\n    const trigger = { ok: this.config.zOnOk, cancel: this.config.zOnCancel }[action];\n\n    if (trigger instanceof EventEmitter) {\n      trigger.emit(this.getContentComponent());\n    } else if (typeof trigger === 'function') {\n      const result = trigger(this.getContentComponent()) as R;\n      this.closeWithResult(result);\n    } else {\n      this.close();\n    }\n  }\n\n  private getContentComponent(): T {\n    return this.componentInstance as T;\n  }\n\n  private closeWithResult(result: R): void {\n    if (result !== false) {\n      this.close(result);\n    }\n  }\n}\n"
    },
    {
      "name": "dialog.variants.ts",
      "content": "import { cva, type VariantProps } from 'class-variance-authority';\n\nexport const dialogVariants = cva(\n  'fixed left-[50%] top-[50%] z-50 grid w-full translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg rounded-lg max-w-[calc(100%-2rem)] sm:max-w-[425px]',\n);\nexport type ZardDialogVariants = VariantProps<typeof dialogVariants>;\n"
    }
  ],
  "registryDependencies": [
    "button",
    "core",
    "icon"
  ]
}
