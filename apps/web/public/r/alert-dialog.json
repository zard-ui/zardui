{
  "name": "alert-dialog",
  "type": "registry:component",
  "files": [
    {
      "name": "alert-dialog.component.ts",
      "content": "import { A11yModule } from '@angular/cdk/a11y';\nimport { OverlayModule } from '@angular/cdk/overlay';\nimport {\n  BasePortalOutlet,\n  CdkPortalOutlet,\n  type ComponentPortal,\n  PortalModule,\n  type TemplatePortal,\n} from '@angular/cdk/portal';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  type ComponentRef,\n  computed,\n  ElementRef,\n  type EmbeddedViewRef,\n  type EventEmitter,\n  inject,\n  NgModule,\n  output,\n  type TemplateRef,\n  type Type,\n  viewChild,\n  type ViewContainerRef,\n  ViewEncapsulation,\n} from '@angular/core';\n\nimport type { ClassValue } from 'clsx';\n\nimport { generateId, mergeClasses, noopFn } from '@/shared/utils/merge-classes';\n\nimport type { ZardAlertDialogRef } from './alert-dialog-ref';\nimport { ZardAlertDialogService } from './alert-dialog.service';\nimport { alertDialogVariants } from './alert-dialog.variants';\nimport { ZardButtonComponent } from '../button/button.component';\n\nexport type OnClickCallback<T> = (instance: T) => false | void | object;\n\nexport class ZardAlertDialogOptions<T> {\n  zCancelText?: string | null;\n  zClosable?: boolean;\n  zContent?: string | TemplateRef<T> | Type<T>;\n  zCustomClasses?: ClassValue;\n  zData?: object;\n  zDescription?: string;\n  zMaskClosable?: boolean;\n  zOkDestructive?: boolean;\n  zOkDisabled?: boolean;\n  zOkText?: string | null;\n  zOnCancel?: EventEmitter<T> | OnClickCallback<T> = noopFn;\n  zOnOk?: EventEmitter<T> | OnClickCallback<T> = noopFn;\n  zTitle?: string | TemplateRef<T>;\n  zViewContainerRef?: ViewContainerRef;\n  zWidth?: string;\n}\n\n@Component({\n  selector: 'z-alert-dialog',\n  imports: [OverlayModule, PortalModule, ZardButtonComponent, A11yModule],\n  standalone: true,\n  templateUrl: './alert-dialog.component.html',\n  styles: `\n    z-alert-dialog {\n      inset: 0;\n      margin: auto;\n      width: fit-content;\n      height: fit-content;\n      transform-origin: center center;\n      opacity: 1;\n      transform: scale(1);\n      transition:\n        opacity 150ms ease-out,\n        transform 150ms ease-out;\n    }\n\n    @starting-style {\n      z-alert-dialog {\n        opacity: 0;\n        transform: scale(0.9);\n      }\n    }\n\n    z-alert-dialog.alert-dialog-leave {\n      opacity: 0;\n      transform: scale(0.9);\n      transition:\n        opacity 150ms ease-in,\n        transform 150ms ease-in;\n    }\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n  host: {\n    '[class]': 'classes()',\n    '[style.width]': 'config.zWidth ? config.zWidth : null',\n    role: 'alertdialog',\n    '[attr.aria-modal]': 'true',\n    '[attr.aria-labelledby]': 'titleId()',\n    '[attr.aria-describedby]': 'descriptionId()',\n    'animate.enter': 'alert-dialog-enter',\n    'animate.leave': 'alert-dialog-leave',\n  },\n  exportAs: 'zAlertDialog',\n})\nexport class ZardAlertDialogComponent<T> extends BasePortalOutlet {\n  private readonly host = inject(ElementRef<HTMLElement>);\n  protected readonly config = inject(ZardAlertDialogOptions<T>);\n\n  protected readonly classes = computed(() => mergeClasses(alertDialogVariants(), this.config.zCustomClasses));\n\n  private readonly alertDialogId = generateId('alert-dialog');\n  protected readonly titleId = computed(() => (this.config.zTitle ? `${this.alertDialogId}-title` : null));\n  protected readonly descriptionId = computed(() =>\n    this.config.zDescription ? `${this.alertDialogId}-description` : null,\n  );\n\n  alertDialogRef?: ZardAlertDialogRef<T>;\n\n  protected readonly isStringContent = computed(() => typeof this.config.zContent === 'string');\n\n  readonly portalOutlet = viewChild.required(CdkPortalOutlet);\n\n  okTriggered = output<void>();\n  cancelTriggered = output<void>();\n\n  constructor() {\n    super();\n  }\n\n  getNativeElement(): HTMLElement {\n    return this.host.nativeElement;\n  }\n\n  attachComponentPortal<T>(portal: ComponentPortal<T>): ComponentRef<T> {\n    if (this.portalOutlet()?.hasAttached()) {\n      throw new Error('Attempting to attach alert dialog content after content is already attached');\n    }\n    return this.portalOutlet()?.attachComponentPortal(portal);\n  }\n\n  attachTemplatePortal<C>(portal: TemplatePortal<C>): EmbeddedViewRef<C> {\n    if (this.portalOutlet()?.hasAttached()) {\n      throw new Error('Attempting to attach alert dialog content after content is already attached');\n    }\n\n    return this.portalOutlet()?.attachTemplatePortal(portal);\n  }\n\n  onOkClick() {\n    this.okTriggered.emit();\n  }\n\n  onCancelClick() {\n    this.cancelTriggered.emit();\n  }\n}\n\n@NgModule({\n  imports: [ZardButtonComponent, ZardAlertDialogComponent, OverlayModule, PortalModule, A11yModule],\n  providers: [ZardAlertDialogService],\n})\nexport class ZardAlertDialogModule {}\n"
    },
    {
      "name": "alert-dialog.component.html",
      "content": "<div class=\"flex flex-col gap-4 p-6\" cdkTrapFocus [cdkTrapFocusAutoCapture]=\"true\">\n  @if (config.zTitle || config.zDescription) {\n    <header class=\"flex flex-col gap-2 text-center sm:text-left\">\n      @if (config.zTitle) {\n        <h2 data-testid=\"z-alert-title\" [id]=\"titleId()\" class=\"text-lg font-semibold\">{{ config.zTitle }}</h2>\n      }\n\n      @if (config.zDescription) {\n        <p data-testid=\"z-alert-description\" [id]=\"descriptionId()\" class=\"text-muted-foreground text-sm\">\n          {{ config.zDescription }}\n        </p>\n      }\n    </header>\n  }\n\n  <main>\n    <ng-template cdkPortalOutlet />\n\n    @if (isStringContent()) {\n      <div data-testid=\"z-alert-content\" [innerHTML]=\"config.zContent\"></div>\n    }\n  </main>\n\n  <footer class=\"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end\">\n    @if (config.zCancelText !== null) {\n      <button type=\"button\" data-testid=\"z-alert-cancel-button\" z-button zType=\"outline\" (click)=\"onCancelClick()\">\n        {{ config.zCancelText || 'Cancel' }}\n      </button>\n    }\n\n    @if (config.zOkText !== null) {\n      <button\n        type=\"button\"\n        data-testid=\"z-alert-ok-button\"\n        z-button\n        [zType]=\"config.zOkDestructive ? 'destructive' : 'default'\"\n        [zDisabled]=\"config.zOkDisabled\"\n        (click)=\"onOkClick()\"\n      >\n        {{ config.zOkText || 'Continue' }}\n      </button>\n    }\n  </footer>\n</div>\n"
    },
    {
      "name": "alert-dialog.service.ts",
      "content": "import { type ComponentType, Overlay, OverlayConfig, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal, TemplatePortal } from '@angular/cdk/portal';\nimport { isPlatformBrowser } from '@angular/common';\nimport {\n  inject,\n  Injectable,\n  InjectionToken,\n  Injector,\n  PLATFORM_ID,\n  TemplateRef,\n  ViewContainerRef,\n} from '@angular/core';\n\nimport { ZardAlertDialogRef } from './alert-dialog-ref';\nimport { ZardAlertDialogComponent, ZardAlertDialogOptions } from './alert-dialog.component';\n\ntype ContentType<T> = ComponentType<T> | TemplateRef<T> | string | undefined;\n\nexport const Z_ALERT_MODAL_DATA = new InjectionToken<unknown>('Z_ALERT_MODAL_DATA');\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ZardAlertDialogService {\n  private readonly overlay = inject(Overlay);\n  private readonly injector = inject(Injector);\n  private readonly platformId = inject(PLATFORM_ID);\n\n  create<T>(config: ZardAlertDialogOptions<T>): ZardAlertDialogRef<T> {\n    return this.open<T>(config.zContent, config);\n  }\n\n  confirm<T>(\n    config: Omit<ZardAlertDialogOptions<T>, 'zOkText' | 'zCancelText'> & {\n      zOkText?: string;\n      zCancelText?: string;\n    },\n  ): ZardAlertDialogRef<T> {\n    const confirmConfig: ZardAlertDialogOptions<T> = {\n      ...config,\n      zOkText: config.zOkText ?? 'Confirm',\n      zCancelText: config.zCancelText ?? 'Cancel',\n      zOkDestructive: config.zOkDestructive ?? false,\n    };\n    return this.create(confirmConfig);\n  }\n\n  warning<T>(config: Omit<ZardAlertDialogOptions<T>, 'zOkText'> & { zOkText?: string }): ZardAlertDialogRef<T> {\n    const warningConfig: ZardAlertDialogOptions<T> = {\n      ...config,\n      zOkText: config.zOkText ?? 'OK',\n      zCancelText: null,\n    };\n    return this.create(warningConfig);\n  }\n\n  info<T>(config: Omit<ZardAlertDialogOptions<T>, 'zOkText'> & { zOkText?: string }): ZardAlertDialogRef<T> {\n    const infoConfig: ZardAlertDialogOptions<T> = {\n      ...config,\n      zOkText: config.zOkText ?? 'OK',\n      zCancelText: null,\n    };\n    return this.create(infoConfig);\n  }\n\n  private open<T>(componentOrTemplateRef: ContentType<T>, config: ZardAlertDialogOptions<T>) {\n    const overlayRef = this.createOverlay();\n\n    if (!overlayRef) {\n      return new ZardAlertDialogRef(\n        undefined as unknown as OverlayRef,\n        config,\n        undefined as unknown as ZardAlertDialogComponent<T>,\n      );\n    }\n\n    const alertDialogContainer = this.attachAlertDialogContainer<T>(overlayRef, config);\n    const alertDialogRef = this.attachAlertDialogContent<T>(\n      componentOrTemplateRef,\n      alertDialogContainer,\n      overlayRef,\n      config,\n    );\n\n    alertDialogContainer.alertDialogRef = alertDialogRef;\n\n    return alertDialogRef;\n  }\n\n  private createOverlay(): OverlayRef | undefined {\n    if (!isPlatformBrowser(this.platformId)) return undefined;\n\n    const overlayConfig = new OverlayConfig({\n      hasBackdrop: true,\n      backdropClass: 'cdk-overlay-dark-backdrop',\n      positionStrategy: this.overlay.position().global(),\n    });\n\n    return this.overlay.create(overlayConfig);\n  }\n\n  private attachAlertDialogContainer<T>(overlayRef: OverlayRef, config: ZardAlertDialogOptions<T>) {\n    const injector = Injector.create({\n      parent: this.injector,\n      providers: [\n        { provide: OverlayRef, useValue: overlayRef },\n        { provide: ZardAlertDialogOptions, useValue: config },\n      ],\n    });\n\n    const containerPortal = new ComponentPortal<ZardAlertDialogComponent<T>>(\n      ZardAlertDialogComponent,\n      config.zViewContainerRef,\n      injector,\n    );\n\n    const containerRef = overlayRef.attach(containerPortal);\n\n    return containerRef.instance;\n  }\n\n  private attachAlertDialogContent<T>(\n    componentOrTemplateRef: ContentType<T>,\n    alertDialogContainer: ZardAlertDialogComponent<T>,\n    overlayRef: OverlayRef,\n    config: ZardAlertDialogOptions<T>,\n  ) {\n    const alertDialogRef = new ZardAlertDialogRef<T>(overlayRef, config, alertDialogContainer);\n\n    if (componentOrTemplateRef instanceof TemplateRef) {\n      alertDialogContainer.attachTemplatePortal(\n        new TemplatePortal<T>(\n          componentOrTemplateRef,\n          null as unknown as ViewContainerRef,\n          {\n            alertDialogRef,\n          } as T,\n        ),\n      );\n    } else if (componentOrTemplateRef && typeof componentOrTemplateRef !== 'string') {\n      const injector = this.createInjector<T>(alertDialogRef, config);\n      const contentRef = alertDialogContainer.attachComponentPortal(\n        new ComponentPortal(componentOrTemplateRef, config.zViewContainerRef, injector),\n      );\n      alertDialogRef.componentInstance = contentRef.instance;\n    }\n\n    return alertDialogRef;\n  }\n\n  private createInjector<T>(alertDialogRef: ZardAlertDialogRef<T>, config: ZardAlertDialogOptions<T>) {\n    return Injector.create({\n      parent: this.injector,\n      providers: [\n        { provide: ZardAlertDialogRef, useValue: alertDialogRef },\n        { provide: Z_ALERT_MODAL_DATA, useValue: config.zData },\n      ],\n    });\n  }\n}\n"
    },
    {
      "name": "alert-dialog-ref.ts",
      "content": "import type { OverlayRef } from '@angular/cdk/overlay';\n\nimport { filter, Subject, takeUntil } from 'rxjs';\n\nimport { noopFn } from '@/shared/utils/merge-classes';\n\nimport type { OnClickCallback, ZardAlertDialogComponent, ZardAlertDialogOptions } from './alert-dialog.component';\n\nexport class ZardAlertDialogRef<T = unknown> {\n  private readonly destroy$ = new Subject<void>();\n  private isClosing = false;\n\n  componentInstance?: T;\n\n  constructor(\n    private readonly overlayRef: OverlayRef,\n    private readonly config: ZardAlertDialogOptions<T>,\n    private readonly containerInstance: ZardAlertDialogComponent<T>,\n  ) {\n    containerInstance.cancelTriggered.subscribe(() => this.handleCancel());\n    containerInstance.okTriggered.subscribe(() => this.handleOk());\n\n    this.handleMaskClick();\n    this.handleEscapeKey();\n  }\n\n  close(): void {\n    if (this.isClosing) {\n      return;\n    }\n    this.isClosing = true;\n\n    const element = this.containerInstance.getNativeElement?.() ?? null;\n    if (element) {\n      element.classList.add('alert-dialog-leave');\n    }\n    this.waitForTransitionEnd(element)\n      .then(() => this.dispose())\n      .catch(noopFn);\n  }\n\n  private handleCancel(): void {\n    const cancelFn = this.config.zOnCancel;\n    if (typeof cancelFn === 'function') {\n      const result = (cancelFn as OnClickCallback<T>)(this.componentInstance as T);\n      if (result !== false) {\n        this.close();\n      }\n    } else {\n      this.close();\n    }\n  }\n\n  private handleOk(): void {\n    const okFn = this.config.zOnOk;\n    if (typeof okFn === 'function') {\n      const result = (okFn as OnClickCallback<T>)(this.componentInstance as T);\n      if (result !== false) {\n        this.close();\n      }\n    } else {\n      this.close();\n    }\n  }\n\n  private handleMaskClick(): void {\n    const hasMaskClosable = this.config.zMaskClosable ?? true;\n    if (hasMaskClosable) {\n      this.overlayRef\n        .outsidePointerEvents()\n        .pipe(takeUntil(this.destroy$))\n        .subscribe(() => this.close());\n    }\n  }\n\n  private handleEscapeKey(): void {\n    this.overlayRef\n      .keydownEvents()\n      .pipe(\n        filter(event => event.key === 'Escape'),\n        takeUntil(this.destroy$),\n      )\n      .subscribe(() => this.close());\n  }\n\n  private async waitForTransitionEnd(element: HTMLElement | null): Promise<void> {\n    if (!element) {\n      await new Promise(resolve => setTimeout(resolve, 150));\n      return;\n    }\n\n    await Promise.race([\n      new Promise<void>(resolve => {\n        const handler = () => {\n          element.removeEventListener('transitionend', handler);\n          resolve();\n        };\n        element.addEventListener('transitionend', handler, { once: true });\n      }),\n      new Promise(resolve => setTimeout(resolve, 150)),\n    ]);\n  }\n\n  private dispose(): void {\n    try {\n      this.overlayRef?.dispose();\n    } catch {\n      // Overlay already destroyed or SSR\n    }\n\n    if (!this.destroy$.closed) {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n  }\n}\n"
    },
    {
      "name": "alert-dialog.variants.ts",
      "content": "import { cva, type VariantProps } from 'class-variance-authority';\n\nexport const alertDialogVariants = cva(\n  'fixed z-50 w-full max-w-[calc(100%-2rem)] border bg-background shadow-lg rounded-lg sm:max-w-lg',\n);\n\nexport type ZardAlertDialogVariants = VariantProps<typeof alertDialogVariants>;\n"
    }
  ],
  "registryDependencies": [
    "button"
  ]
}
