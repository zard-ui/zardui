{
  "name": "sheet",
  "type": "registry:component",
  "files": [
    {
      "name": "sheet.component.ts",
      "content": "import { OverlayModule } from '@angular/cdk/overlay';\nimport {\n  BasePortalOutlet,\n  CdkPortalOutlet,\n  type ComponentPortal,\n  PortalModule,\n  type TemplatePortal,\n} from '@angular/cdk/portal';\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  type ComponentRef,\n  computed,\n  ElementRef,\n  type EmbeddedViewRef,\n  type EventEmitter,\n  inject,\n  output,\n  signal,\n  type TemplateRef,\n  type Type,\n  viewChild,\n  type ViewContainerRef,\n} from '@angular/core';\n\nimport type { ZardSheetRef } from './sheet-ref';\nimport { sheetVariants, type ZardSheetVariants } from './sheet.variants';\nimport { ZardButtonComponent } from '../button/button.component';\nimport { ZardIconComponent } from '../icon/icon.component';\nimport type { ZardIcon } from '../icon/icons';\n\nimport { mergeClasses, noopFun } from '@/shared/utils/merge-classes';\n\nexport type OnClickCallback<T> = (instance: T) => false | void | object;\nexport class ZardSheetOptions<T, U> {\n  zCancelIcon?: ZardIcon;\n  zCancelText?: string | null;\n  zClosable?: boolean;\n  zContent?: string | TemplateRef<T> | Type<T>;\n  zCustomClasses?: string;\n  zData?: U;\n  zDescription?: string;\n  zHeight?: string;\n  zHideFooter?: boolean;\n  zMaskClosable?: boolean;\n  zOkDestructive?: boolean;\n  zOkDisabled?: boolean;\n  zOkIcon?: ZardIcon;\n  zOkText?: string | null;\n  zOnCancel?: EventEmitter<T> | OnClickCallback<T> = noopFun;\n  zOnOk?: EventEmitter<T> | OnClickCallback<T> = noopFun;\n  zSide?: ZardSheetVariants['zSide'] = 'left';\n  zSize?: ZardSheetVariants['zSize'] = 'default';\n  zTitle?: string | TemplateRef<T>;\n  zViewContainerRef?: ViewContainerRef;\n  zWidth?: string;\n}\n\n@Component({\n  selector: 'z-sheet',\n  imports: [OverlayModule, PortalModule, ZardButtonComponent, ZardIconComponent],\n  template: `\n    @if (config.zClosable || config.zClosable === undefined) {\n      <button\n        type=\"button\"\n        data-testid=\"z-close-header-button\"\n        z-button\n        zType=\"ghost\"\n        zSize=\"sm\"\n        class=\"absolute top-1 right-1 cursor-pointer\"\n        (click)=\"onCloseClick()\"\n      >\n        <z-icon zType=\"x\" />\n      </button>\n    }\n\n    @if (config.zTitle || config.zDescription) {\n      <header data-slot=\"sheet-header\" class=\"flex flex-col gap-1.5 p-4\">\n        @if (config.zTitle) {\n          <h4 data-testid=\"z-title\" data-slot=\"sheet-title\" class=\"text-lg leading-none font-semibold tracking-tight\">\n            {{ config.zTitle }}\n          </h4>\n\n          @if (config.zDescription) {\n            <p data-testid=\"z-description\" data-slot=\"sheet-description\" class=\"text-muted-foreground text-sm\">\n              {{ config.zDescription }}\n            </p>\n          }\n        }\n      </header>\n    }\n\n    <main class=\"flex w-full flex-col space-y-4\">\n      <ng-template cdkPortalOutlet />\n\n      @if (isStringContent) {\n        <div data-testid=\"z-content\" data-slot=\"sheet-content\" [innerHTML]=\"config.zContent\"></div>\n      }\n    </main>\n\n    @if (!config.zHideFooter) {\n      <footer data-slot=\"sheet-footer\" class=\"mt-auto flex flex-col gap-2 p-4\">\n        @if (config.zOkText !== null) {\n          <button\n            type=\"button\"\n            data-testid=\"z-ok-button\"\n            class=\"cursor-pointer\"\n            z-button\n            [zType]=\"config.zOkDestructive ? 'destructive' : 'default'\"\n            [disabled]=\"config.zOkDisabled\"\n            (click)=\"onOkClick()\"\n          >\n            @if (config.zOkIcon) {\n              <z-icon [zType]=\"config.zOkIcon\" />\n            }\n\n            {{ config.zOkText ?? 'OK' }}\n          </button>\n        }\n\n        @if (config.zCancelText !== null) {\n          <button\n            type=\"button\"\n            data-testid=\"z-cancel-button\"\n            class=\"cursor-pointer\"\n            z-button\n            zType=\"outline\"\n            (click)=\"onCloseClick()\"\n          >\n            @if (config.zCancelIcon) {\n              <z-icon [zType]=\"config.zCancelIcon\" />\n            }\n\n            {{ config.zCancelText ?? 'Cancel' }}\n          </button>\n        }\n      </footer>\n    }\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  host: {\n    'data-slot': 'sheet',\n    '[class]': 'classes()',\n    '[attr.data-state]': 'state()',\n    '[style.width]': 'config.zWidth ? config.zWidth + \" !important\" : null',\n    '[style.height]': 'config.zHeight ? config.zHeight + \" !important\" : null',\n  },\n  exportAs: 'zSheet',\n})\nexport class ZardSheetComponent<T, U> extends BasePortalOutlet {\n  private readonly host = inject(ElementRef<HTMLElement>);\n  protected readonly config = inject(ZardSheetOptions<T, U>);\n\n  protected readonly classes = computed(() => {\n    const zSize = this.config.zWidth || this.config.zHeight ? 'custom' : this.config.zSize;\n\n    return mergeClasses(\n      sheetVariants({\n        zSide: this.config.zSide,\n        zSize,\n      }),\n      this.config.zCustomClasses,\n    );\n  });\n\n  sheetRef?: ZardSheetRef<T>;\n\n  protected readonly isStringContent = typeof this.config.zContent === 'string';\n\n  readonly portalOutlet = viewChild.required(CdkPortalOutlet);\n\n  readonly okTriggered = output<void>();\n  readonly cancelTriggered = output<void>();\n  readonly state = signal<'closed' | 'open'>('closed');\n\n  constructor() {\n    super();\n  }\n\n  getNativeElement(): HTMLElement {\n    return this.host.nativeElement;\n  }\n\n  attachComponentPortal<T>(portal: ComponentPortal<T>): ComponentRef<T> {\n    if (this.portalOutlet()?.hasAttached()) {\n      throw new Error('Attempting to attach modal content after content is already attached');\n    }\n    return this.portalOutlet()?.attachComponentPortal(portal);\n  }\n\n  attachTemplatePortal<C>(portal: TemplatePortal<C>): EmbeddedViewRef<C> {\n    if (this.portalOutlet()?.hasAttached()) {\n      throw new Error('Attempting to attach modal content after content is already attached');\n    }\n\n    return this.portalOutlet()?.attachTemplatePortal(portal);\n  }\n\n  onOkClick() {\n    this.okTriggered.emit();\n  }\n\n  onCloseClick() {\n    this.cancelTriggered.emit();\n  }\n}\n"
    },
    {
      "name": "sheet.variants.ts",
      "content": "import { cva, type VariantProps } from 'class-variance-authority';\n\nexport const sheetVariants = cva(\n  'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500',\n  {\n    variants: {\n      zSide: {\n        right:\n          'data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 border-l',\n        left: 'data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 border-r',\n        top: 'data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 border-b',\n        bottom:\n          'data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 border-t',\n      },\n      zSize: {\n        default: '',\n        sm: '',\n        lg: '',\n        custom: '',\n      },\n    },\n    compoundVariants: [\n      {\n        zSide: ['left', 'right'],\n        zSize: 'default',\n        class: 'w-3/4 sm:max-w-sm h-full',\n      },\n      {\n        zSide: ['left', 'right'],\n        zSize: 'sm',\n        class: 'w-1/2 sm:max-w-xs h-full',\n      },\n      {\n        zSide: ['left', 'right'],\n        zSize: 'lg',\n        class: 'w-full sm:max-w-lg h-full',\n      },\n      {\n        zSide: ['top', 'bottom'],\n        zSize: 'default',\n        class: 'h-auto',\n      },\n      {\n        zSide: ['top', 'bottom'],\n        zSize: 'sm',\n        class: 'h-1/3',\n      },\n      {\n        zSide: ['top', 'bottom'],\n        zSize: 'lg',\n        class: 'h-3/4',\n      },\n    ],\n    defaultVariants: {\n      zSide: 'right',\n      zSize: 'default',\n    },\n  },\n);\nexport type ZardSheetVariants = VariantProps<typeof sheetVariants>;\n"
    },
    {
      "name": "sheet-ref.ts",
      "content": "import type { OverlayRef } from '@angular/cdk/overlay';\nimport { isPlatformBrowser } from '@angular/common';\nimport { EventEmitter, Inject, PLATFORM_ID } from '@angular/core';\n\nimport { filter, fromEvent, Subject, takeUntil } from 'rxjs';\n\nimport type { ZardSheetComponent, ZardSheetOptions } from './sheet.component';\n\nconst enum eTriggerAction {\n  CANCEL = 'cancel',\n  OK = 'ok',\n}\n\nexport class ZardSheetRef<T = any, R = any, U = any> {\n  private destroy$ = new Subject<void>();\n  private isClosing = false;\n  protected result?: R;\n  componentInstance: T | null = null;\n\n  constructor(\n    private overlayRef: OverlayRef,\n    private config: ZardSheetOptions<T, U>,\n    private containerInstance: ZardSheetComponent<T, U>,\n    @Inject(PLATFORM_ID) private platformId: object,\n  ) {\n    this.containerInstance.cancelTriggered.subscribe(() => this.trigger(eTriggerAction.CANCEL));\n    this.containerInstance.okTriggered.subscribe(() => this.trigger(eTriggerAction.OK));\n\n    if ((this.config.zMaskClosable ?? true) && isPlatformBrowser(this.platformId)) {\n      this.overlayRef\n        .outsidePointerEvents()\n        .pipe(takeUntil(this.destroy$))\n        .subscribe(() => this.close());\n    }\n\n    if (isPlatformBrowser(this.platformId)) {\n      fromEvent<KeyboardEvent>(document, 'keydown')\n        .pipe(\n          filter(event => event.key === 'Escape'),\n          takeUntil(this.destroy$),\n        )\n        .subscribe(() => this.close());\n    }\n  }\n\n  close(result?: R) {\n    if (this.isClosing) {\n      return;\n    }\n\n    this.isClosing = true;\n    this.result = result;\n    this.containerInstance.state.set('closed');\n\n    if (isPlatformBrowser(this.platformId)) {\n      const element = this.containerInstance.getNativeElement();\n      let cleanupCalled = false;\n\n      const onAnimationEnd = () => {\n        if (cleanupCalled) {\n          return;\n        }\n\n        cleanupCalled = true;\n        element.removeEventListener('animationend', onAnimationEnd);\n        this.closeCleanup();\n      };\n\n      element.addEventListener('animationend', onAnimationEnd);\n      setTimeout(onAnimationEnd, 300); // Fallback after expected animation duration\n    } else {\n      this.closeCleanup();\n    }\n  }\n\n  private trigger(action: eTriggerAction) {\n    const trigger = { ok: this.config.zOnOk, cancel: this.config.zOnCancel }[action];\n\n    if (trigger instanceof EventEmitter) {\n      trigger.emit(this.getContentComponent());\n    } else if (typeof trigger === 'function') {\n      const result = trigger(this.getContentComponent()) as R;\n      this.closeWithResult(result);\n    } else this.close();\n  }\n\n  private getContentComponent(): T {\n    return this.componentInstance as T;\n  }\n\n  private closeWithResult(result: R): void {\n    if (result !== false) this.close(result);\n  }\n\n  private closeCleanup(): void {\n    if (this.overlayRef) {\n      if (this.overlayRef.hasAttached()) {\n        this.overlayRef.detachBackdrop();\n      }\n      this.overlayRef.dispose();\n    }\n\n    if (!this.destroy$.closed) {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n  }\n}\n"
    },
    {
      "name": "sheet.module.ts",
      "content": "import { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\n\nimport { ZardSheetComponent } from './sheet.component';\nimport { ZardSheetService } from './sheet.service';\nimport { ZardButtonComponent } from '../button/button.component';\n\nconst components = [CommonModule, ZardButtonComponent, ZardSheetComponent, OverlayModule, PortalModule];\n\n@NgModule({\n  imports: components,\n  exports: components,\n})\nexport class ZardBreadcrumbModule {}\n\n@NgModule({\n  imports: [CommonModule, ZardButtonComponent, ZardSheetComponent, OverlayModule, PortalModule],\n  providers: [ZardSheetService],\n})\nexport class ZardSheetModule {}\n"
    },
    {
      "name": "sheet.service.ts",
      "content": "import { type ComponentType, Overlay, OverlayConfig, OverlayRef } from '@angular/cdk/overlay';\nimport { ComponentPortal, TemplatePortal } from '@angular/cdk/portal';\nimport { isPlatformBrowser } from '@angular/common';\nimport { inject, Injectable, InjectionToken, Injector, PLATFORM_ID, TemplateRef } from '@angular/core';\n\nimport { ZardSheetRef } from './sheet-ref';\nimport { ZardSheetComponent, ZardSheetOptions } from './sheet.component';\n\ntype ContentType<T> = ComponentType<T> | TemplateRef<T> | string;\nexport const Z_MODAL_DATA = new InjectionToken<any>('Z_MODAL_DATA');\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ZardSheetService {\n  private overlay = inject(Overlay);\n  private injector = inject(Injector);\n  private platformId = inject(PLATFORM_ID);\n\n  create<T, U>(config: ZardSheetOptions<T, U>): ZardSheetRef<T> {\n    return this.open<T, U>(config.zContent as ComponentType<T>, config);\n  }\n\n  private open<T, U>(componentOrTemplateRef: ContentType<T>, config: ZardSheetOptions<T, U>) {\n    const overlayRef = this.createOverlay();\n\n    if (!overlayRef) {\n      // Return a mock sheet ref for SSR environments\n      return new ZardSheetRef(undefined as any, config, undefined as any, this.platformId);\n    }\n\n    const sheetContainer = this.attachSheetContainer<T, U>(overlayRef, config);\n\n    const sheetRef = this.attachSheetContent<T, U>(componentOrTemplateRef, sheetContainer, overlayRef, config);\n    sheetContainer.sheetRef = sheetRef;\n\n    return sheetRef;\n  }\n\n  private createOverlay(): OverlayRef | undefined {\n    if (isPlatformBrowser(this.platformId)) {\n      const overlayConfig = new OverlayConfig({\n        hasBackdrop: true,\n        positionStrategy: this.overlay.position().global(),\n      });\n\n      return this.overlay.create(overlayConfig);\n    }\n    return undefined;\n  }\n\n  private attachSheetContainer<T, U>(overlayRef: OverlayRef, config: ZardSheetOptions<T, U>) {\n    const injector = Injector.create({\n      parent: this.injector,\n      providers: [\n        { provide: OverlayRef, useValue: overlayRef },\n        { provide: ZardSheetOptions, useValue: config },\n      ],\n    });\n\n    const containerPortal = new ComponentPortal<ZardSheetComponent<T, U>>(\n      ZardSheetComponent,\n      config.zViewContainerRef,\n      injector,\n    );\n    const containerRef = overlayRef.attach<ZardSheetComponent<T, U>>(containerPortal);\n    containerRef.instance.state.set('open');\n\n    return containerRef.instance;\n  }\n\n  private attachSheetContent<T, U>(\n    componentOrTemplateRef: ContentType<T>,\n    sheetContainer: ZardSheetComponent<T, U>,\n    overlayRef: OverlayRef,\n    config: ZardSheetOptions<T, U>,\n  ) {\n    const sheetRef = new ZardSheetRef<T>(overlayRef, config, sheetContainer, this.platformId);\n\n    if (componentOrTemplateRef instanceof TemplateRef) {\n      sheetContainer.attachTemplatePortal(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        new TemplatePortal<T>(componentOrTemplateRef, null!, {\n          sheetRef: sheetRef,\n        } as any),\n      );\n    } else if (typeof componentOrTemplateRef !== 'string') {\n      const injector = this.createInjector<T, U>(sheetRef, config);\n      const contentRef = sheetContainer.attachComponentPortal<T>(\n        new ComponentPortal(componentOrTemplateRef, config.zViewContainerRef, injector),\n      );\n      sheetRef.componentInstance = contentRef.instance;\n    }\n\n    return sheetRef;\n  }\n\n  private createInjector<T, U>(sheetRef: ZardSheetRef<T>, config: ZardSheetOptions<T, U>) {\n    return Injector.create({\n      parent: this.injector,\n      providers: [\n        { provide: ZardSheetRef, useValue: sheetRef },\n        { provide: Z_MODAL_DATA, useValue: config.zData },\n      ],\n    });\n  }\n}\n"
    }
  ],
  "registryDependencies": [
    "button",
    "core",
    "icon"
  ]
}
