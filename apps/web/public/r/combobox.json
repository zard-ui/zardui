{
  "name": "combobox",
  "type": "registry:component",
  "files": [
    {
      "name": "combobox.component.ts",
      "content": "import { NgTemplateOutlet } from '@angular/common';\nimport {\n  afterNextRender,\n  booleanAttribute,\n  ChangeDetectionStrategy,\n  Component,\n  computed,\n  ElementRef,\n  forwardRef,\n  inject,\n  Injector,\n  input,\n  output,\n  runInInjectionContext,\n  signal,\n  viewChild,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { type ControlValueAccessor, FormsModule, NG_VALUE_ACCESSOR } from '@angular/forms';\n\nimport type { ClassValue } from 'clsx';\n\nimport { ZardButtonComponent, type ZardButtonTypeVariants } from '@/shared/components/button';\nimport { comboboxVariants, type ZardComboboxWidthVariants } from '@/shared/components/combobox/combobox.variants';\nimport {\n  ZardCommandComponent,\n  ZardCommandEmptyComponent,\n  ZardCommandInputComponent,\n  ZardCommandListComponent,\n  ZardCommandOptionComponent,\n  ZardCommandOptionGroupComponent,\n  type ZardCommandOption,\n} from '@/shared/components/command';\nimport { ZardEmptyComponent } from '@/shared/components/empty';\nimport { ZardIconComponent, type ZardIcon } from '@/shared/components/icon';\nimport { ZardPopoverComponent, ZardPopoverDirective } from '@/shared/components/popover';\nimport { mergeClasses } from '@/shared/utils/merge-classes';\n\nexport interface ZardComboboxOption {\n  value: string;\n  label: string;\n  disabled?: boolean;\n  icon?: ZardIcon;\n}\n\nexport interface ZardComboboxGroup {\n  label?: string;\n  options: ZardComboboxOption[];\n}\n\n@Component({\n  selector: 'z-combobox',\n  imports: [\n    FormsModule,\n    NgTemplateOutlet,\n    ZardButtonComponent,\n    ZardCommandComponent,\n    ZardCommandInputComponent,\n    ZardCommandListComponent,\n    ZardCommandEmptyComponent,\n    ZardCommandOptionComponent,\n    ZardCommandOptionGroupComponent,\n    ZardPopoverDirective,\n    ZardPopoverComponent,\n    ZardEmptyComponent,\n    ZardIconComponent,\n  ],\n  template: `\n    <button\n      type=\"button\"\n      z-button\n      zPopover\n      role=\"combobox\"\n      [zContent]=\"popoverContent\"\n      [zType]=\"buttonVariant()\"\n      [class]=\"buttonClasses()\"\n      [zDisabled]=\"disabled()\"\n      [attr.aria-expanded]=\"open()\"\n      [attr.aria-haspopup]=\"'listbox'\"\n      [attr.aria-controls]=\"'combobox-listbox'\"\n      [attr.aria-label]=\"ariaLabel() || 'Select option'\"\n      [attr.aria-describedby]=\"ariaDescribedBy()\"\n      [attr.aria-autocomplete]=\"searchable() ? 'list' : 'none'\"\n      [attr.aria-activedescendant]=\"null\"\n      (zVisibleChange)=\"setOpen($event)\"\n      #popoverTrigger\n    >\n      <span class=\"flex-1 truncate text-left\">\n        {{ displayValue() ?? placeholder() }}\n      </span>\n      <z-icon zType=\"chevrons-up-down\" class=\"ml-2 shrink-0 opacity-50\" />\n    </button>\n\n    <ng-template #popoverContent>\n      <z-popover [class]=\"popoverClasses()\">\n        <z-command class=\"min-h-auto\" (zCommandSelected)=\"handleSelect($event)\" #commandRef>\n          @if (searchable()) {\n            <z-command-input [placeholder]=\"searchPlaceholder()\" #commandInputRef />\n          }\n\n          <z-command-list id=\"combobox-listbox\" role=\"listbox\">\n            @if (emptyText()) {\n              <z-command-empty>\n                <z-empty [zDescription]=\"emptyText()\" />\n              </z-command-empty>\n            }\n\n            @for (group of groups(); track group.label ?? $index) {\n              @if (group.label) {\n                <z-command-option-group [zLabel]=\"group.label\" #commandGroup>\n                  @for (option of group.options; track option.value) {\n                    <ng-container\n                      [ngTemplateOutlet]=\"commandOption\"\n                      [ngTemplateOutletContext]=\"{\n                        $implicit: option,\n                        commandInstance: commandRef,\n                        groupInstance: commandGroup,\n                      }\"\n                    />\n                  }\n                </z-command-option-group>\n              } @else {\n                @for (option of group.options; track option.value) {\n                  <ng-container\n                    [ngTemplateOutlet]=\"commandOption\"\n                    [ngTemplateOutletContext]=\"{\n                      $implicit: option,\n                      commandInstance: commandRef,\n                    }\"\n                  />\n                }\n              }\n            } @empty {\n              @if (options().length > 0) {\n                @for (option of options(); track option.value) {\n                  <ng-container\n                    [ngTemplateOutlet]=\"commandOption\"\n                    [ngTemplateOutletContext]=\"{\n                      $implicit: option,\n                      commandInstance: commandRef,\n                    }\"\n                  />\n                }\n              }\n            }\n          </z-command-list>\n        </z-command>\n      </z-popover>\n    </ng-template>\n\n    <ng-template #commandOption let-option let-cmd=\"commandInstance\" let-grp=\"groupInstance\">\n      <z-command-option\n        [zValue]=\"option.value\"\n        [zLabel]=\"option.label\"\n        [zDisabled]=\"option.disabled ?? false\"\n        [zIcon]=\"option.icon\"\n        [parentCommand]=\"cmd\"\n        [commandGroup]=\"grp\"\n        [attr.aria-selected]=\"option.value === currentValue()\"\n      >\n        {{ option.label }}\n        @if (option.value === currentValue()) {\n          <z-icon zType=\"check\" class=\"ml-auto\" />\n        }\n      </z-command-option>\n    </ng-template>\n  `,\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => ZardComboboxComponent),\n      multi: true,\n    },\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  encapsulation: ViewEncapsulation.None,\n  host: {\n    '[class]': 'classes()',\n    '(document:keydown.escape)': 'onDocumentKeyDown($event)',\n    '(keydown.escape.prevent-with-stop)': 'onKeyDownEscape()',\n    '(keydown.{arrowdown,arrowup,enter,home,end,pageup,pagedown,space}.prevent)': 'onKeyDown($event)',\n    '(keydown.tab)': 'onKeyDown($event)',\n  },\n  exportAs: 'zCombobox',\n})\nexport class ZardComboboxComponent implements ControlValueAccessor {\n  private readonly injector = inject(Injector);\n\n  readonly class = input<ClassValue>('');\n  readonly buttonVariant = input<ZardButtonTypeVariants>('outline');\n  readonly zWidth = input<ZardComboboxWidthVariants>('default');\n  readonly placeholder = input<string>('Select...');\n  readonly searchPlaceholder = input<string>('Search...');\n  readonly emptyText = input<string>('No results found.');\n  readonly disabled = input(false, { transform: booleanAttribute });\n  readonly searchable = input(true, { transform: booleanAttribute });\n  readonly value = input<string | null>(null);\n  readonly options = input<ZardComboboxOption[]>([]);\n  readonly groups = input<ZardComboboxGroup[]>([]);\n  readonly ariaLabel = input<string>('');\n  readonly ariaDescribedBy = input<string>('');\n\n  readonly zValueChange = output<string | null>();\n  readonly zComboSelected = output<ZardComboboxOption>();\n\n  readonly popoverDirective = viewChild.required('popoverTrigger', { read: ZardPopoverDirective });\n  readonly buttonRef = viewChild.required('popoverTrigger', { read: ElementRef });\n  readonly commandRef = viewChild('commandRef', { read: ZardCommandComponent });\n  readonly commandInputRef = viewChild('commandInputRef', { read: ZardCommandInputComponent });\n\n  protected readonly open = signal(false);\n  protected readonly internalValue = signal<string | null>(null);\n\n  protected readonly classes = computed(() =>\n    mergeClasses(\n      comboboxVariants({\n        zWidth: this.zWidth(),\n      }),\n      this.class(),\n    ),\n  );\n\n  protected readonly buttonClasses = computed(() => 'w-full justify-between');\n\n  protected readonly popoverClasses = computed(() => {\n    const widthClass = this.zWidth() === 'full' ? 'w-full' : comboboxVariants({ zWidth: this.zWidth() });\n    return `${widthClass} p-0`;\n  });\n\n  protected readonly currentValue = computed(() => this.value() ?? this.internalValue());\n\n  protected readonly displayValue = computed(() => {\n    const currentValue = this.currentValue();\n    if (!currentValue) {\n      return null;\n    }\n\n    // Search in groups first\n    if (this.groups().length) {\n      for (const group of this.groups()) {\n        const option = group.options.find(opt => opt.value === currentValue);\n        if (option) {\n          return option.label;\n        }\n      }\n    }\n\n    // Then search in flat options\n    const option = this.options().find(opt => opt.value === currentValue);\n    return option?.label ?? null;\n  });\n\n  private onChange: (value: string | null) => void = () => {\n    // ControlValueAccessor implementation\n  };\n\n  private onTouched: () => void = () => {\n    // ControlValueAccessor implementation\n  };\n\n  setOpen(open: boolean) {\n    this.open.set(open);\n    if (open) {\n      runInInjectionContext(this.injector, () =>\n        afterNextRender(() => {\n          const commandRef = this.commandRef();\n          if (commandRef) {\n            // Refresh options to ensure they're detected\n            commandRef.refreshOptions();\n            // Focus on search input if searchable, otherwise on command component\n            if (this.searchable()) {\n              this.commandInputRef()?.focus();\n            } else {\n              commandRef.focus();\n            }\n          }\n        }),\n      );\n    }\n  }\n\n  handleSelect(commandOption: ZardCommandOption) {\n    const selectedValue = commandOption.value as string;\n\n    // Toggle behavior - if same value is selected, clear it\n    const newValue = selectedValue === this.currentValue() ? null : selectedValue;\n\n    this.internalValue.set(newValue);\n    this.onChange(newValue);\n    this.zValueChange.emit(newValue);\n\n    // Emit the combobox option if we have a selection\n    if (newValue) {\n      let selectedOption: ZardComboboxOption | undefined;\n\n      if (this.groups().length > 0) {\n        for (const group of this.groups()) {\n          selectedOption = group.options.find(opt => opt.value === newValue);\n          if (selectedOption) {\n            break;\n          }\n        }\n      } else {\n        selectedOption = this.options().find(opt => opt.value === newValue);\n      }\n\n      if (selectedOption) {\n        this.zComboSelected.emit(selectedOption);\n      }\n    }\n\n    // Close the popover\n    this.popoverDirective().hide();\n\n    // Return focus to the combobox button after selection\n    this.buttonRef().nativeElement.focus();\n  }\n\n  onKeyDownEscape(): void {\n    if (this.open()) {\n      this.popoverDirective().hide();\n      this.buttonRef().nativeElement.focus();\n    } else if (this.currentValue()) {\n      this.internalValue.set(null);\n      this.onChange(null);\n      this.zValueChange.emit(null);\n    }\n  }\n\n  onKeyDown(e: Event) {\n    if (this.disabled()) {\n      return;\n    }\n\n    const { key, ctrlKey, altKey, metaKey } = e as KeyboardEvent;\n\n    // Handle different keyboard events based on combobox state\n    if (this.open()) {\n      // When popover is open\n      switch (key) {\n        case 'Tab':\n          // Allow tab to close and move to next element\n          this.popoverDirective().hide();\n          break;\n        case 'ArrowDown':\n        case 'ArrowUp':\n        case 'Enter':\n        case 'Home':\n        case 'End':\n        case 'PageUp':\n        case 'PageDown':\n          // Forward navigation to command component\n          this.commandRef()?.onKeyDown(e as KeyboardEvent);\n          break;\n      }\n    } else {\n      // When popover is closed\n      switch (key) {\n        case 'ArrowDown':\n        case 'ArrowUp':\n        case 'Enter':\n        case ' ': // Space key\n          this.popoverDirective().show();\n          break;\n        default:\n          // For searchable comboboxes, open and start typing\n          if (this.searchable() && key.length === 1 && !ctrlKey && !altKey && !metaKey) {\n            this.popoverDirective().show();\n            // Let the command input handle the character after opening\n            runInInjectionContext(this.injector, () =>\n              afterNextRender(() => {\n                const inputElement = this.commandInputRef();\n                if (inputElement) {\n                  inputElement.searchInput().nativeElement.value = key;\n                  inputElement.updateParentComponents(key);\n                  inputElement.focus();\n                }\n              }),\n            );\n          }\n          break;\n      }\n    }\n  }\n\n  // needed when component loses focus by keyboard.\n  onDocumentKeyDown(event: Event) {\n    // Close on Escape from anywhere when this combobox is open\n    if (this.open()) {\n      const target = event.target as Element;\n      const buttonElement = this.buttonRef().nativeElement;\n      // Only handle if not already handled by the component itself\n      if (!buttonElement.contains(target)) {\n        this.popoverDirective().hide();\n        this.buttonRef().nativeElement.focus();\n      }\n    }\n  }\n\n  // ControlValueAccessor implementation\n  writeValue(value: string | null): void {\n    this.internalValue.set(value);\n  }\n\n  registerOnChange(fn: (value: string | null) => void): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn: () => void): void {\n    this.onTouched = fn;\n  }\n}\n"
    },
    {
      "name": "combobox.variants.ts",
      "content": "import { cva, type VariantProps } from 'class-variance-authority';\n\nexport const comboboxVariants = cva('', {\n  variants: {\n    zWidth: {\n      default: 'w-50',\n      sm: 'w-37.5',\n      md: 'w-62.5',\n      lg: 'w-87.5',\n      full: 'w-full',\n    },\n  },\n  defaultVariants: {\n    zWidth: 'default',\n  },\n});\n\nexport type ZardComboboxWidthVariants = NonNullable<VariantProps<typeof comboboxVariants>['zWidth']>;\n"
    },
    {
      "name": "index.ts",
      "content": "export * from './combobox.component';\nexport * from './combobox.variants';\n"
    }
  ],
  "registryDependencies": [
    "button",
    "command",
    "popover",
    "empty",
    "input",
    "icon"
  ],
  "docs": {
    "overview": "# Combobox\n\nA combobox is an autocomplete input and command palette with a list of suggestions. The Combobox is built using a composition of the `<Popover />` and the `<Command />` components.\n",
    "api": "# API\n\n| Property            | Type                                               | Default               | Description                                 |\n| ------------------- | -------------------------------------------------- | --------------------- | ------------------------------------------- |\n| `class`             | `ClassValue`                                       | `''`                  | Additional CSS classes                      |\n| `buttonVariant`     | `'default' \\| 'outline' \\| 'secondary' \\| 'ghost'` | `'outline'`           | Button variant style                        |\n| `zWidth`            | `'default' \\| 'sm' \\| 'md' \\| 'lg' \\| 'full'`      | `'default'`           | Width of the combobox                       |\n| `placeholder`       | `string`                                           | `'Select...'`         | Placeholder text when no value is selected  |\n| `searchPlaceholder` | `string`                                           | `'Search...'`         | Placeholder for the search input            |\n| `emptyText`         | `string`                                           | `'No results found.'` | Text shown when no options match the search |\n| `disabled`          | `boolean`                                          | `false`               | Whether the combobox is disabled            |\n| `searchable`        | `boolean`                                          | `true`                | Whether to show the search input            |\n| `value`             | `string \\| null`                                   | `null`                | The selected value                          |\n| `options`           | `ZardComboboxOption[]`                             | `[]`                  | Array of options (for flat list)            |\n| `groups`            | `ZardComboboxGroup[]`                              | `[]`                  | Array of grouped options                    |\n| `ariaLabel`         | `string`                                           | `''`                  | ARIA label for accessibility                |\n| `ariaDescribedBy`   | `string`                                           | `''`                  | ARIA described-by for accessibility         |\n\n### Outputs\n\n| Event            | Type                         | Description                        |\n| ---------------- | ---------------------------- | ---------------------------------- |\n| `zValueChange`   | `output<string \\| null>`     | Emitted when the value changes     |\n| `zComboSelected` | `output<ZardComboboxOption>` | Emitted when an option is selected |\n"
  },
  "demos": [
    {
      "name": "default.ts",
      "content": "import { Component } from '@angular/core';\n\nimport { ZardComboboxComponent, type ZardComboboxOption } from '../combobox.component';\n\n@Component({\n  selector: 'zard-demo-combobox-default',\n  imports: [ZardComboboxComponent],\n  standalone: true,\n  template: `\n    <z-combobox\n      [options]=\"frameworks\"\n      placeholder=\"Select framework...\"\n      searchPlaceholder=\"Search framework...\"\n      emptyText=\"No framework found.\"\n      (zComboSelected)=\"onSelect($event)\"\n    />\n  `,\n})\nexport class ZardDemoComboboxDefaultComponent {\n  frameworks: ZardComboboxOption[] = [\n    { value: 'angular', label: 'Angular' },\n    { value: 'react', label: 'React' },\n    { value: 'vue', label: 'Vue.js' },\n    { value: 'svelte', label: 'Svelte' },\n    { value: 'ember', label: 'Ember.js' },\n    { value: 'nextjs', label: 'Next.js' },\n  ];\n\n  onSelect(option: ZardComboboxOption) {\n    console.log('Selected:', option);\n  }\n}\n"
    },
    {
      "name": "disabled.ts",
      "content": "import { Component } from '@angular/core';\n\nimport { ZardComboboxComponent, type ZardComboboxOption } from '../combobox.component';\n\n@Component({\n  selector: 'zard-demo-combobox-disabled',\n  imports: [ZardComboboxComponent],\n  standalone: true,\n  template: `\n    <div class=\"flex gap-4\">\n      <z-combobox [options]=\"frameworks\" placeholder=\"Disabled combobox\" [disabled]=\"true\" />\n\n      <z-combobox\n        [options]=\"frameworksWithDisabled\"\n        placeholder=\"Select framework...\"\n        searchPlaceholder=\"Search framework...\"\n        emptyText=\"No framework found.\"\n      />\n    </div>\n  `,\n})\nexport class ZardDemoComboboxDisabledComponent {\n  frameworks: ZardComboboxOption[] = [\n    { value: 'angular', label: 'Angular' },\n    { value: 'react', label: 'React' },\n    { value: 'vue', label: 'Vue.js' },\n  ];\n\n  frameworksWithDisabled: ZardComboboxOption[] = [\n    { value: 'angular', label: 'Angular' },\n    { value: 'react', label: 'React', disabled: true },\n    { value: 'vue', label: 'Vue.js' },\n    { value: 'svelte', label: 'Svelte', disabled: true },\n    { value: 'ember', label: 'Ember.js' },\n  ];\n}\n"
    },
    {
      "name": "form.ts",
      "content": "import { Component } from '@angular/core';\nimport { FormControl, ReactiveFormsModule } from '@angular/forms';\n\nimport { ZardButtonComponent } from '../../button/button.component';\nimport { ZardComboboxComponent, type ZardComboboxOption } from '../combobox.component';\n\n@Component({\n  selector: 'zard-demo-combobox-form',\n  imports: [ReactiveFormsModule, ZardComboboxComponent, ZardButtonComponent],\n  standalone: true,\n  template: `\n    <div class=\"flex flex-col gap-4\">\n      <z-combobox\n        [options]=\"frameworks\"\n        placeholder=\"Select framework...\"\n        searchPlaceholder=\"Search framework...\"\n        emptyText=\"No framework found.\"\n        [formControl]=\"frameworkControl\"\n      />\n\n      <div class=\"flex gap-2\">\n        <button z-button variant=\"outline\" (click)=\"setValue()\">Set to Vue.js</button>\n        <button z-button variant=\"outline\" (click)=\"clearValue()\">Clear</button>\n        <button z-button variant=\"outline\" (click)=\"logValue()\">Log Value</button>\n      </div>\n\n      <div class=\"text-muted-foreground text-sm\">Current value: {{ frameworkControl.value ?? 'None' }}</div>\n    </div>\n  `,\n})\nexport class ZardDemoComboboxFormComponent {\n  frameworkControl = new FormControl<string | null>(null);\n\n  frameworks: ZardComboboxOption[] = [\n    { value: 'angular', label: 'Angular' },\n    { value: 'react', label: 'React' },\n    { value: 'vue', label: 'Vue.js' },\n    { value: 'svelte', label: 'Svelte' },\n    { value: 'ember', label: 'Ember.js' },\n  ];\n\n  setValue() {\n    this.frameworkControl.setValue('vue');\n  }\n\n  clearValue() {\n    this.frameworkControl.setValue(null);\n  }\n\n  logValue() {\n    console.log('Form Control Value:', this.frameworkControl.value);\n  }\n}\n"
    },
    {
      "name": "grouped.ts",
      "content": "import { Component } from '@angular/core';\n\nimport { ZardComboboxComponent, type ZardComboboxGroup, type ZardComboboxOption } from '../combobox.component';\n\n@Component({\n  selector: 'zard-demo-combobox-grouped',\n  imports: [ZardComboboxComponent],\n  standalone: true,\n  template: `\n    <z-combobox\n      [groups]=\"techGroups\"\n      placeholder=\"Select technology...\"\n      searchPlaceholder=\"Search technology...\"\n      emptyText=\"No technology found.\"\n      (zComboSelected)=\"onSelect($event)\"\n    />\n  `,\n})\nexport class ZardDemoComboboxGroupedComponent {\n  techGroups: ZardComboboxGroup[] = [\n    {\n      label: 'Frontend Frameworks',\n      options: [\n        { value: 'angular', label: 'Angular' },\n        { value: 'react', label: 'React' },\n        { value: 'vue', label: 'Vue.js' },\n        { value: 'svelte', label: 'Svelte' },\n      ],\n    },\n    {\n      label: 'Backend Frameworks',\n      options: [\n        { value: 'nestjs', label: 'NestJS' },\n        { value: 'express', label: 'Express' },\n        { value: 'fastify', label: 'Fastify' },\n        { value: 'koa', label: 'Koa' },\n      ],\n    },\n    {\n      label: 'Full-Stack Frameworks',\n      options: [\n        { value: 'nextjs', label: 'Next.js' },\n        { value: 'nuxtjs', label: 'Nuxt.js' },\n        { value: 'remix', label: 'Remix' },\n        { value: 'sveltekit', label: 'SvelteKit' },\n      ],\n    },\n  ];\n\n  onSelect(option: ZardComboboxOption) {\n    console.log('Selected:', option);\n  }\n}\n"
    }
  ]
}
